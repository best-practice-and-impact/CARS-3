---
title: "Summary statistics"
output:
  html_document:
    toc: true
    toc_depth: 1
    toc_float: 
      collapsed: false
---

```{r global-options, include=FALSE}
# Set echo=FALSE for all chunks
knitr::opts_chunk$set(echo=FALSE)

library(magrittr)

tables <- carsurvey3::summarise_all(data)
prof_langs <- carsurvey3::summarise_languages_by_prof(data)

```

This is a living document. 

We want our users to get as much value as possible from our analysis. Because of that, we will be updating these pages with additional outputs and insights when possible. To make sure you always access the latest insights, we recommend linking to these pages rather than sharing this analysis any other way at this stage. 


# Coding frequency and tools


## Most respondents use code at least regularly in their current role

Over half of respondents reported using code to achieve their work objectives regularly or all the time. This survey is likely to have attracted many analysts with an interest in programming, meaning these figures may be skewed. Nevertheless, the figures here show that many analysts are regularly using code to carry out their work.

```{r}
plot <- carsurvey2::plot_freqs(tables$code_freq, "Coding frequency", "Count", n = samples$all, font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$code_freq)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$all))

carsurvey2::wrap_outputs("coding-freq", plot, table)

```
<br>

## Respondents use code to perform a variety of data operations 

For each of the data operations included in the survey, the majority of analysts use code to carry them out at least some of the time. Many respondents reported other data operations in the free text box provided. Government analysts are capable to carry out a variety of tasks using code, including every part of the analytical pipeline. 

```{r}
plot <- carsurvey2::plot_stacked(tables$operations, "Count", "Data operation", n = samples$all, font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$operations)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$all))

carsurvey2::wrap_outputs("operations", plot, table)
```
<br>

## Access to and knowledge of programming languages

Given a list of programming tools, we asked respondents to answer “Yes”, “No” or “Don’t know” for the following statements;

* This tool is available to use for my work.
* I know how to program with this tool to a level suitable for my work. 

Please note we did not set precise definitions for availability and knowledge here, as these are dependent on individual circumstances. 

<br>

## Open source tools are the most available for analysts work

R, SQL and Python were the three most available programming languages to government analysts. All three are open source languages, the use of which is a key component of the [RAP methodology](https://gss.civilservice.gov.uk/reproducible-analytical-pipelines/). Such tools help analysts make their work more transparent and accessible to users, as cost is not a barrier to learning these languages. 

```{r}
plot <- carsurvey2::plot_stacked(tables$access, xlab = "Count", ylab = "Programming tool", n = samples$all, colour_scale = "3scale", font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$access, row.names = FALSE)) %>%  kableExtra::add_footnote(paste0("Sample size = ", samples$all))

carsurvey2::wrap_outputs("tools-access", plot, table)
```
<br>

## Open source tools are leading the way in capability

More respondents said they were able to carry out their work using Python, SQL and R than any other programming language. R in particular is consistently popular across professions, having the highest or second highest levels of capability across all analytical professions. In contrast, proprietary tools are much more profession-specific. These open source languages present the best opportunity for collaboration and recruitment, as there are l

```{r}
plot <- carsurvey2::plot_stacked(tables$knowledge, xlab = "Count", ylab = "Programming tool", n = samples$all, colour_scale = "3scale", font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$knowledge, row.names = FALSE)) %>%  kableExtra::add_footnote(paste0("Sample size = ", samples$all))

carsurvey2::wrap_outputs("tools-knowledge", plot, table)
```


```{r}
plot <- carsurvey3::freq_subplots(prof_langs, "", "Percent", y_margin = .1, x_margin = .15, orientation = "h", height = 900, width = 600, nrows = 4, font_size = 14)

prof_langs[[3]] <- round(prof_langs[[3]], 1)
colnames(prof_langs) <- c("Programming language", "Profession", "Know how to use (percent)")

table <-  kableExtra::kable_styling(knitr::kable(prof_langs, row.names = FALSE))

carsurvey2::wrap_outputs("prof_langs", plot, table)
```
<br>

## Many respondents have capability in tools they cannot access in work

Using data collected from previous questions we calculated the number of respondents who have access but no knowledge, access and knowledge, and knowledge but no access for each programming language. 

A large minority of respondents have capability in programming languages they do not have access to. This is particularly true for proprietary software. A further advantage of open-source software is that it is easier for analysts' coding skills to be transferable if they learn an open-source language, as they are more likely to have access to the same software at another department in future.


```{r}

plot <- carsurvey2::plot_stacked(tables$language_status, colour_scale = "3scale", xlab = "Count", ylab = "Programming tool", n = samples$all, font_size = 14, width = 700)

table <- kableExtra::kable_styling(knitr::kable(tables$language_status, row.names = FALSE)) %>%
  kableExtra::add_footnote(paste0("Sample size = ", samples$all))

carsurvey2::wrap_outputs("tools-status", plot, table)

```
<br>

# Coding capability

<br>

## Most respondents learned to code outside of the public sector

Analysts are generally learning to code for the first time before joining the public sector, particularly in education. However, many reported learning to code for the first time in their current role or in previous public sector employment. This shows that not only are analysts with previous coding experience improving, but those without those skills are being upskilled as well.


``` {r}

plot <- carsurvey2::plot_freqs(tables$where_learned, xlab = "", ylab = "Count", n = samples$any_code_experience, break_q_names_col = "First coding experience", orientation = "h", font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$where_learned, row.names = FALSE)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$any_code_experience))

carsurvey2::wrap_outputs("first-learn", plot, table)

```
<br>

## Most analysts said their coding ability has improved during current role

Responses show many analysts in government are either maintaining or actively improving their coding capability. But this is not true across the board. A large minority reported a decrease in their coding abilities in their current role. 

This question was only asked of respondents with coding experience outside of their current role. This means the data does not cover those who first learned to code in their current role.


``` {r}
plot <- carsurvey2::plot_freqs(tables$ability_change, xlab = "Change in ability", ylab = "Count", n = samples$code_outside_current_role, break_q_names_col = "Ability Change", font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$ability_change, row.names = FALSE)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$code_outside_current_role))

carsurvey2::wrap_outputs("ability", plot, table)

```
<br>

## Most respondents learned to code outside of the public sector


Analysts are generally learning to code for the first time before joining the public sector, particularly in education. However, many reported learning to code for the first time in their current role or in previous public sector employment. This shows that not only are analysts with previous coding experience improving, but those without those skills are being upskilled as well.


``` {r}
plot <- carsurvey2::plot_freqs(tables$where_learned, xlab = "", ylab = "Count", n = samples$any_code_experience, break_q_names_col = "First coding experience", orientation = "h", font_size = 14, width = 600)
table <- kableExtra::kable_styling(knitr::kable(tables$where_learned, row.names = FALSE)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$any_code_experience))
carsurvey2::wrap_outputs("first-learn", plot, table)
```
<br> 

## How often people code in their work is correlated with changes to their coding abilities

Across government, code capability appears to be increasing. Many are picking up and improving these skills while working in government. How often people write code at work is positively correlated with the change in their coding ability (r(16) = .59, p < .01). Conversely, those who do not code in their work are much more likely to report their coding abilities are getting worse. Although this finding is not surprising, it highlights the fact that analysts' coding abilities are not static, and need to be maintained. 

``` {r}

plot <- carsurvey2::plot_likert(tables$capability_change_by_freq, 3, "Capability change", "", 912, font_size = 14, width = 800, height = 800)

table <- kableExtra::kable_styling(knitr::kable(tables$capability_change_by_freq)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$all))

carsurvey2::wrap_outputs("cap-by-freq", plot, table)
```

<br>

# Coding practices

We asked respondents who said they use code in their work how often they carry out various coding practices considered to be good practice. For more information on the practices presented below, please read our guidance on [quality assurance of code for analysis and research](https://best-practice-and-impact.github.io/qa-of-code-guidance/intro.html).

<br>
## Many good coding practices are not regularly applied by analysts

The practices list below are intended to improve the reproducibility, assurance and auditability of code. Most respondents reporting using these practices at least some of the time, but often not regularly. It appears many analysts have the skills to use these practices, but either do not have time or do not feel the need to do so.

```{r}
plot <- carsurvey2::plot_likert(tables$coding_practices, 5, "Frequency", "", n = samples$coders, neutral_mid = FALSE, font_size = 14, height = 1200, width = 700, break_q_names_col = "Question", max_lines = 3)

table <- kableExtra::kable_styling(carsurvey2::output_likert_table(tables$coding_practices)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$coders))

carsurvey2::wrap_outputs("code-prac", plot, table)

```
<br>

## Most types of documentation are not regularly used

Similarly, most respondents do not write most forms of code documentation regularly, with the exception of code comments. 

[Embedded documentation](https://best-practice-and-impact.github.io/qa-of-code-guidance/code_documentation.html) is one of the components which make up a RAP minimum viable product. Documentation is important to help others be clear on what the code is doing.


```{r}
plot <- carsurvey2::plot_likert(tables$doc, 5, "Frequency", "", n = samples$coders, neutral_mid = FALSE, font_size = 14, height = 700, width = 700, break_q_names_col = "Question")

table <- kableExtra::kable_styling(carsurvey2::output_likert_table(tables$doc)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$coders))

carsurvey2::wrap_outputs("doc", plot, table)

```
<br>

## A minority are using dependency management or reproducible workflow packages

More advanced coding practices are less common still, with only a minority carrying them out at all. 

```{r}

plot <- carsurvey2::plot_freqs(tables$dependency_management, xlab = "Use dependency management software", ylab = "count", n = samples$coders, break_q_names_col = "Use dependency management software", font_size = 14, width = 600)


table <- kableExtra::kable_styling(knitr::kable(tables$dependency_management)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$coders))

carsurvey2::wrap_outputs("dep_management", plot, table)

```
<br>



```{r}

plot <- carsurvey2::plot_freqs(tables$rep_workflow, xlab = "Use reproducible workflows packages", ylab = "count", n = samples$coders, break_q_names_col = "Use reproducible workflow packages", font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$rep_workflow)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$coders))

carsurvey2::wrap_outputs("workflow", plot, table)

```
<br>

# RAP knowledge and opinions

We asked respondents about their knowledge of and opinions on [reproducible analytical pipelines (RAP)](https://gss.civilservice.gov.uk/reproducible-analytical-pipelines/). RAP refers to the use of practices from software engineering to make analysis more reproducible. These practices build on the advantages of writing analysis as code by ensuring increased quality, trust, efficiency, business continuity and knowledge management. The [RAP champions](https://gss.civilservice.gov.uk/about-us/champion-networks/reproducible-analytical-pipeline-rap-champions/) are a network of analysts across government who promote and support RAP development in their departments.

<br>
# Most respondents have heard of RAP, but many do not know who their RAP champions are

65% of respondents have heard of RAP which means a large minority haven’t heard of RAP and its principles. Of those who have heard or RAP, most do not know who their department RAP champion is. [RAP champions](https://analysisfunction.civilservice.gov.uk/support/reproducible-analytical-pipelines/reproducible-analytical-pipeline-rap-champions/) promote and support RAP development across government. There is clearly more to be done to make sure people are aware of RAP and know where they can find support. 

```{r}
plot <- carsurvey2::plot_freqs(tables$rap_knowledge, "", "Count", n = samples$all, font_size = 14, orientation = "h", break_q_names_col = "RAP champion knowledge", max_lines = 3, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$rap_knowledge, row.names = FALSE)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$all))

carsurvey2::wrap_outputs("rap-knowledge", plot, table)

```
<br>

## Respondents are positive about RAP knowledge and implementation

We asked respondents who had heard of RAP whether they agreed with a series of statements.

```{r}
plot <- carsurvey2::plot_likert(tables$rap_opinions, 3, "Frequency", "", n = samples$heard_of_rap, font_size = 14, height = 700, width = 700, break_q_names_col = "Question")

table <- kableExtra::kable_styling(carsurvey2::output_likert_table(tables$rap_opinions)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$heard_of_rap))

carsurvey2::wrap_outputs("rap-opinions", plot, table)

```
<br>

# RAP scores

RAP scores are the sum of scores for each component of the [minimum viable product (MVP)](https://gss.civilservice.gov.uk/reproducible-analytical-pipelines/). A score of one for each RAP component is derived where respondents answered “regularly” or “all the time” to the relevant questions. For documentation, this includes both code comments and README files. For the continuous integration and dependency management components we only collected "yes", "no" or "I don't understand the question" responses. As such, we gave "yes" responses a score of 1. The sum total of each respondent's scores is presented here as "RAP scores". “Basic components” are the components which make up the RAP MVP. "Advanced components" are RAP components that go beyond what the RAP champions saw as the minimum standard.

<br>

## None of the RAP components are applied consistently

While some RAP components are applied often by most respondents, the majority are not, including the majority of the MVP components. Open sourcing in particular is only done by a minority of respondents. That means that, most of the time, analysts are not meeting the mimimum RAP guidance when writing code. 

```{r}
plot <- carsurvey2::plot_grouped(tables$rap_components, "", "Count", n = samples$coders, orientation = "h", font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$rap_components, row.names = FALSE)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$coders))

carsurvey2::wrap_outputs("rap_comps", plot, table)

```

<br>

## Most respondents only apply a minority of recommended practices regularly

Only a minority of respondents regularly more than half of the RAP MVP standards in their work (22%), with a small minority meeting all of the MVP standards (2%). These findings show most analysts who write code do meet some RAP standards but not others. More work needs to be done to share knowledge and expertise in these good coding practices, to ensure analyst apply RAP guidance more consistently.

```{r}

bar_colour <- carsurvey2::get_2colour_scale(2)[2][[1]]
bar_colour <- rgb(bar_colour[1],bar_colour[2],bar_colour[3], maxColorValue = 255)

plot <- carsurvey2::plot_freqs(tables$basic_rap_scores, "Basic RAP score", "Count", bar_colour = bar_colour, n = samples$coders, font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$basic_rap_scores, row.names = FALSE)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$coders))

carsurvey2::wrap_outputs("basic_score", plot, table)

```
<br>

## Few respondents regularly use half or more of the advanced RAP components

Only a minority of respondents apply the majority of the more advanced RAP practices included here. However, it should be noted that not all of these would be applicable or proportionate for every analytical pipelines, and we do not necessarily recommend they all be applied every time.

```{r}

plot <- carsurvey2::plot_freqs(tables$advanced_rap_scores, "Advanced RAP score", "Count", n = samples$coders, font_size = 14, width = 600)

table <- kableExtra::kable_styling(knitr::kable(tables$advanced_rap_scores, row.names = FALSE)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", samples$coders))

carsurvey2::wrap_outputs("advanced_score", plot, table)

```

<br>

## Respondents who tell us they are implementing RAP use more of the RAP MVP practices, more often

```{r}
corr_data <- data[data$heard_of_RAP == "Yes" & data$code_freq != "Never", ]

likert_order <- c("Strongly Disagree",
                  "Disagree",
                  "Neutral", 
                  "Agree",
                  "Strongly Agree")

corr_data$RAP_implementing <- factor(corr_data$RAP_implementing, levels = likert_order)
corr_data$RAP_understand_key_components <- factor(corr_data$RAP_understand_key_components, levels = likert_order)

implement_corr <- carsurvey3::compute_correlation_test(corr_data$RAP_implementing, corr_data$basic_rap_score)
understand_corr <- carsurvey3::compute_correlation_test(corr_data$RAP_understand_key_components, corr_data$basic_rap_score)
```

Although very few regularly meet the RAP MVP, there is a positive correlation (r(24) = .37, p < .01) between respondents self-reporting that they currently implement RAP and their basic RAP score. However, the correlation is relatively weak. This suggests that more can done to improve awareness of the RAP MVP guidance across government. 

```{r}
plot <- carsurvey3::plot_stacked(tables$basic_score_by_implementation, "Percent", "I Currently Implement RAP", sum(data$heard_of_RAP == "Yes" & data$code_freq != "Never"), colour_scale = "2gradients", neutral_mid = FALSE, font_size = 14, width = 600, height = 500)

table <- kableExtra::kable_styling(knitr::kable(tables$basic_score_by_implementation)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", sum(data$heard_of_RAP == "Yes" & data$code_freq != "Never")))

carsurvey2::wrap_outputs("basic-by-imp", plot, table)


```

<br>

## Respondents with a better understanding of RAP use minimum RAP practices more often

There is a positive correlation between self-reported understanding of RAP and basic RAP scores (r(24) = .39, p < .01). This suggests increasing awareness of RAP standards and guidelines could help increase the use of RAP practices. However, this is only a correlation and should be treated with caution, as it does not necessarily imply a causal direction.

```{r}
plot <- carsurvey3::plot_stacked(tables$basic_score_by_understanding , "Percent", "I Understand Key concepts of RAP", sum(data$heard_of_RAP == "Yes" & data$code_freq != "Never"), colour_scale = "2gradients", neutral_mid = FALSE, font_size = 14, width = 600, height = 500)

table <- kableExtra::kable_styling(knitr::kable(tables$basic_score_by_understanding)) %>% 
  kableExtra::add_footnote(paste0("Sample size = ", sum(data$heard_of_RAP == "Yes" & data$code_freq != "Never")))

carsurvey2::wrap_outputs("basic-by-und", plot, table)


```

